<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”¢å“åˆ†ç´šæŠ˜æ‰£èˆ‡é»æ•¸è¨ˆç®—å·¥å…· (HKD - æœƒå“¡åƒ¹)</title>
    <style>
        /* åŸºæœ¬æ¨£å¼ */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f7f6;
            padding: 20px;
            color: #333;
        }
        .container {
            max-width: 1300px;
            margin: 0 auto;
            background-color: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #007bff;
            text-align: center;
            margin-bottom: 20px;
        }
        
        /* è¡¨æ ¼å®¹å™¨ - è®“è¡¨æ ¼å¯ä»¥åœ¨å°å±ä¸Šæ°´å¹³æ»¾å‹• */
        .table-container {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch; 
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px; 
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
            font-size: 13px;
        }
        th {
            background-color: #e9ecef;
            color: #333;
            font-weight: 600;
        }
        .sku-input, .qty-input {
            width: 90%;
            padding: 6px;
            border: 1px solid #ccc;
            border-radius: 3px;
            box-sizing: border-box;
        }
        .read-only {
            background-color: #f8f9fa;
            color: #555;
            font-weight: bold;
        }
        .add-btn, .quick-input-btn, .print-btn {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 20px;
            float: right;
            margin-left: 10px;
        }
        .quick-input-btn {
            background-color: #ffc107;
            color: #333;
        }
        .print-btn {
            background-color: #007bff;
            float: left;
        }
        /* ç¸½çµå€å¡Šæ¨£å¼ */
        .summary-box {
            background-color: #fff;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }
        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px dashed #eee;
            font-size: 16px;
        }
        .total-due {
            margin-top: 15px;
            background-color: #dc3545; 
            color: white;
            padding: 12px;
            border-radius: 4px;
            font-size: 20px;
            text-align: center;
        }
        #searchResults {
            padding: 10px;
            border: 1px dashed #ccc;
            background-color: #ffffff;
            border-radius: 4px;
        }
        .client-type-btn {
            padding: 8px 15px;
            border: 1px solid #ccc;
            background-color: #eee;
            cursor: pointer;
            border-radius: 4px;
            margin-right: 10px;
        }
        .client-type-btn.active {
            background-color: #007bff;
            color: white;
            border-color: #0056b3;
        }
        
        /* --- éŸ¿æ‡‰å¼åª’é«”æŸ¥è©¢é–‹å§‹ --- */

        /* å¹³æ¿è¨­å‚™ (768px - 1024px) */
        @media screen and (max-width: 1024px) {
            .container { padding: 15px; }
            table { font-size: 12px; }
            th, td { padding: 6px; }
            .sku-input, .qty-input { width: 95%; }
        }

        /* ç§»åŠ¨è®¾å¤‡ (å°äº768px) */
        @media screen and (max-width: 768px) {
            .container { padding: 10px; }
            
            /* éš±è—æ¬¡è¦åˆ— (VP & Earn Base) ä»¥ç¯€çœç©ºé–“ */
            table th:nth-child(5), 
            table td:nth-child(5),
            table th:nth-child(6), 
            table td:nth-child(6) {
                display: none;
            }
            
            /* èª¿æ•´æŒ‰éˆ•ä½ˆå±€ */
            .add-btn, .quick-input-btn, .print-btn {
                width: 100%;
                margin: 5px 0;
                float: none;
                box-sizing: border-box;
            }
            
            /* èª¿æ•´å®¢æˆ¶èº«ä»½é¸æ“‡æŒ‰éˆ•ç‚ºå…¨å¯¬å †ç–Š */
            .client-type-btn {
                width: 100%; 
                margin: 5px 0 5px 0; /* Adjust margin for stacking */
                padding: 10px 5px;
                font-size: 14px;
                box-sizing: border-box;
            }
            
            /* èª¿æ•´æœå°‹å’Œé¸æ“‡å€åŸŸä½ˆå±€ */
            #productNameSearch {
                width: 100%;
                box-sizing: border-box;
            }
            .add-btn[onclick="performSearch()"] {
                width: 100%;
                margin: 5px 0;
            }
            
            /* ç§»å‹•è¨­å‚™è¼¸å…¥å„ªåŒ– (é˜²æ­¢iOSè‡ªå‹•ç¸®æ”¾) */
            .sku-input, .qty-input {
                font-size: 16px; 
                padding: 8px;
                width: 100%;
            }
            
            /* ä¼˜åŒ–æ€»ç»“åŒºåŸŸåœ¨ç§»åŠ¨è®¾å¤‡ä¸Šçš„æ˜¾ç¤º */
            .summary-box {
                padding: 15px;
            }
            
            .summary-item {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .summary-item .value {
                margin-top: 5px;
                align-self: flex-end;
            }

            /* ç¢ºä¿æŠ˜æ‰£ä¸‹æ‹‰é¸å–®å…¨å¯¬ */
            #discountLevel {
                width: 100%;
                box-sizing: border-box;
                margin-top: 5px;
            }
        }
        /* --- éŸ¿æ‡‰å¼åª’é«”æŸ¥è©¢çµæŸ --- */
    </style>
</head>
<body>

    <div class="container">
        <h1>ç”¢å“åˆ†ç´šæŠ˜æ‰£èˆ‡é»æ•¸è¨ˆç®—å·¥å…· (HKD æ¸¯å¹£)</h1>

        <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 6px;">
            <div style="margin-bottom: 15px; text-align: center;">
                <label style="font-weight: bold; margin-right: 15px;">ğŸ‘¤ è«‹é¸æ“‡å®¢æˆ¶èº«ä»½:</label>
                <div style="margin-top: 10px; display: flex; justify-content: space-between; flex-wrap: wrap;">
                    <button class="client-type-btn active" id="btn-distributor" onclick="setClientType('distributor')">ç›´éŠ·å•† (Distributor)</button>
                    <button class="client-type-btn" id="btn-pc" onclick="setClientType('pc')">å„ªæƒ å®¢æˆ¶ (PC)</button>
                    <button class="client-type-btn" id="btn-retail" onclick="setClientType('retail')">é›¶å”®å®¢ (Retail) - åŸåƒ¹</button>
                </div>
            </div>

            <div style="display: flex; flex-direction: column; align-items: flex-start;">
                <div style="width: 100%;">
                    <label for="discountLevel" style="font-weight: bold; margin-right: 15px; display: block; margin-bottom: 5px;">ğŸ”– è«‹é¸æ“‡æœ¬æ¬¡è¨‚å–®çš„æŠ˜æ‰£ç´šåˆ¥:</label>
                    <select id="discountLevel" onchange="calculateTotals()" style="padding: 8px; border-radius: 4px; width: 100%;">
                        <option value="0.15">15% æŠ˜æ‰£</option> 
                        <option value="0.25" selected>25% æŠ˜æ‰£</option>
                        <option value="0.35">35% æŠ˜æ‰£</option>
                        <option value="0.42">42% æŠ˜æ‰£</option>
                        <option value="0.50">50% æŠ˜æ‰£</option>
                        <option value="0.00" disabled style="display: none;">0% æŠ˜æ‰£ (é›¶å”®å®¢)</option>
                    </select>
                </div>
                <div id="shipping-rule-display" style="font-weight: bold; color: #dc3545; margin-top: 15px;">
                    é‹è²»è¦å‰‡: è¨‚å–®é›¶å”®ç¸½åƒ¹ HK$ 4,000.00 ä»¥ä¸‹ï¼Œé‹è²» HK$ 30.00
                </div>
            </div>
        </div>
        
        <div style="margin-bottom: 20px; padding: 15px; background: #e6f7ff; border-radius: 6px;">
            <label for="productNameSearch" style="font-weight: bold; margin-right: 15px; display: block; margin-bottom: 5px;">ğŸ” ç”¢å“åç¨±æœå°‹:</label>
            <div style="display: flex; align-items: center; gap: 5px;">
                <input type="text" id="productNameSearch" placeholder="è¼¸å…¥ç”¢å“åç¨±é—œéµå­— (è‡³å°‘ 2 å€‹å­—)" style="padding: 6px; flex-grow: 1; box-sizing: border-box;">
                <button class="add-btn" style="float: none; background-color: #007bff; width: auto;" onclick="performSearch()">æœå°‹</button>
            </div>
            <div id="searchResults" style="margin-top: 10px; display: none;">
                </div>
        </div>

        <div style="margin-bottom: 20px;">
            <button class="print-btn" onclick="generatePrintOrder()">ğŸ–¨ï¸ ç”Ÿæˆåˆ—å°ç”¨è¨‚å–®è¡¨</button>
            <button class="add-btn" onclick="addRow()">+ æ–°å¢ç”¢å“</button>
            <button class="quick-input-btn" onclick="quickFill()">4æ¯æ°´</button>
            <div style="clear: both;"></div>
        </div>
        
        <div class="table-container">
            <table id="productTable">
                <thead>
                    <tr>
                        <th rowspan="2">æ“ä½œ</th>
                        <th rowspan="2">ç”¢å“ç·¨è™Ÿ (SKU)</th>
                        <th rowspan="2">æ•¸é‡ (Qty)</th>
                        <th rowspan="2">ç”¢å“åç¨±</th>
                        <th colspan="2">ç©é»/åŸºæ•¸</th>
                        <th colspan="2">åƒ¹æ ¼ (HK$)</th>
                    </tr>
                    <tr>
                        <th>éŠ·å”®é‡é»æ•¸ (VP)</th>
                        <th>æ”¶å…¥åŸºæ•¸ (Earn Base)</th>
                        <th>è¼”éŠ·å“åƒ¹æ ¼ (Literature Price)</th>
                        <th>é›¶å”®åƒ¹æ ¼ (Retail)</th>
                    </tr>
                </thead>
                <tbody>
                    </tbody>
            </table>
        </div>

        <div style="clear: both;"></div>

        <h2>è¨‚å–®ç¸½çµèˆ‡è¨ˆç®—çµæœ</h2>
        <div class="summary-box">
            <div class="summary-item">
                <span class="label">ç¸½éŠ·å”®é‡é»æ•¸ (VP)</span>
                <span id="sum-vp" class="value" style="color: #009688;">0.00</span>
            </div>
            <div class="summary-item">
                <span class="label">ç¸½æ”¶å…¥åŸºæ•¸ (Earn Base)</span>
                <span id="sum-earnBase" class="value">0.00</span>
            </div>
            <div class="summary-item">
                <span class="label">ç¸½é›¶å”®åƒ¹æ ¼ (åŸåƒ¹)</span>
                <span id="sum-totalRetail" class="value" style="font-weight: bold;">HK$ 0.00</span>
            </div>
            <div class="summary-item" style="font-size: 18px; background: #ffebee;">
                <span class="label">ç¸½æŠ˜æ‰£é‡‘é¡ (<span id="discount-display">25%</span>, åŸºæ–¼ç¸½æ”¶å…¥åŸºæ•¸è¨ˆç®—)</span>
                <span id="sum-discountAmount" class="value" style="color: #dc3545;">- HK$ 0.00</span>
            </div>
            <div class="summary-item" style="border-top: 2px solid #ddd;">
                <span class="label">è‡ªå‹•è¨ˆç®—é‹è²» (<span id="client-type-text">ç›´éŠ·å•†</span>)</span>
                <span id="sum-shipping" class="value" style="font-weight: bold;">HK$ 0.00</span>
            </div>
            <div class="summary-item total-due">
                <span class="label">å®¢æˆ¶æ‡‰æ”¶ç¸½é‡‘é¡ (å«é‹è²»)</span>
                <span id="sum-totalDue" class="value">HK$ 0.00</span>
            </div>
        </div>
    </div>

    <script>
        // --- ç”¢å“æ•¸æ“šåº« (72 é …ç”¢å“) ---
        const productDatabase = {
            '0036': { name: 'å¤œå¯§æ–°ç‡Ÿé¤Šé£²å“ NiteworksÂ®', vp: 89.95, earnBase: 1490.00, literature: 1209.00, retail: 1630.00 },
            '1462': { name: 'é€Ÿå‚™ 24 Herbalife24 Prepare', vp: 73.10, earnBase: 1227.00, literature: 568.00, retail: 1342.00 },
            '1417': { name: 'å¥é«” 24 - æœ±å¤åŠ›å‘³ Herbalife24 Rebuild Strength - Chocolate', vp: 68.45, earnBase: 1028.00, literature: 234.00, retail: 1167.00 },
            '1000': { name: 'é—œæ·å¯¶ Joint Support', vp: 44.00, earnBase: 749.00, literature: 0.00, retail: 819.00 },
            '0056': { name: 'è† åŸè›‹ç™½ç¾è‚Œé£²æ–™ Beauty Powder Drink', vp: 43.55, earnBase: 865.00, literature: 702.00, retail: 946.00 },
            '1457': { name: 'ç‡Ÿé¤Šè›‹ç™½ç´  24 - é›²å‘¢æ‹¿å‘³ Herbalife24 Formula 1 Sports - Creamy Vanilla', vp: 41.60, earnBase: 698.00, literature: 834.00, retail: 764.00 },
            '0768': { name: 'æŠ—çšºç²¾è¯éœœ Herbalife SKIN LINE MINIMIZING SERUM', vp: 37.70, earnBase: 629.00, literature: 511.00, retail: 688.00 },
            '1061': { name: 'å¥³å£«ä¹‹é¸ Woman\'s Choice', vp: 37.00, earnBase: 512.00, literature: 643.00, retail: 560.00 },
            '0100': { name: 'å—æ¥µç£·è¦æ²¹ Krill ShieldÂ®', vp: 35.50, earnBase: 570.00, literature: 476.00, retail: 624.00 },
            '0106': { name: 'å³æº¶è‰æœ¬é£²å“102å…‹ - åŸå‘³ Herbal Tea Concentrate 102g - Original', vp: 34.95, earnBase: 603.00, literature: 491.00, retail: 660.00 },
            '0759': { name: 'å³æº¶è‰æœ¬é£²å“102å…‹ - è˜‹æœç”˜èŠå‘³ Herbal Tea Concentrate 102g - Apple Chamomile', vp: 34.95, earnBase: 603.00, literature: 491.00, retail: 660.00 },
            '0891': { name: 'æ´»é¤Šè‰æœ¬çˆ½è†šæ°´ - 150 æ¯«å‡ Herbalife SKIN ENERGIZING HERBAL TONER - 150ML', vp: 32.30, earnBase: 540.00, literature: 439.00, retail: 591.00 },
            '0769': { name: 'æ³¨é¡ä¿®è­·æ—¥éœœ Herbalife SKIN DAILY GLOW MOISTURIZER', vp: 28.40, earnBase: 474.00, literature: 385.00, retail: 519.00 },
            '0774': { name: 'ä¿®è­·æ™šéœœ Herbalife SKIN REPLENISHING NIGHT CREAM', vp: 28.40, earnBase: 474.00, literature: 385.00, retail: 519.00 },
            '0899': { name: 'é˜²æ›¬æ—¥éœœSPF30/PA+++ Protective Moisturizer SPF30/PA+++', vp: 28.40, earnBase: 474.00, literature: 385.00, retail: 519.00 },
            '0770': { name: 'ç›ˆäº®ç·Šç·»çœ¼éƒ¨å•«å–± Herbalife SKIN FIRMING EYE GEL', vp: 26.35, earnBase: 441.00, literature: 357.00, retail: 482.00 },
            '0771': { name: 'æ·±å±¤æ»‹æ½¤çœ¼éœœ Herbalife SKIN HYDRATING EYE CREAM', vp: 26.35, earnBase: 441.00, literature: 357.00, retail: 482.00 },
            '011K': { name: 'å„ªè³ªè›‹ç™½å’–å•¡ - æœ±å¤åŠ›å’–å•¡ High Protein Iced Coffee - Mocha', vp: 25.95, earnBase: 437.00, literature: 67.00, retail: 478.00 },
            '0065': { name: 'æ·±æµ·é­šæ²¹ HerbalifelineÂ®', vp: 25.75, earnBase: 419.00, literature: 340.00, retail: 458.00 },
            '0006': { name: 'æ¿ƒç¸®è˜†è–ˆæ± Herbal Aloe Concentrate', vp: 24.95, earnBase: 401.00, literature: 325.00, retail: 439.00 },
            '1610': { name: 'æ¿ƒç¸®è˜†è–ˆæ±(è‘¡è„å‘³) Herbal Aloe Concentrate - Grape Flavor', vp: 24.95, earnBase: 401.00, literature: 204.00, retail: 439.00 },
            '0260': { name: 'è›‹ç™½æ£’ - æª¸æª¬ Protein Bar - CITRUS LEMON', vp: 7.70, earnBase: 114.00, literature: 94.00, retail: 207.00 },
            '0378': { name: 'æ—¥æ—¥æ»‹é¤Šè˜†è–ˆæ½¤è†šéœ² Herbal Aloe Everyday Soothing Hand & Body Lotion', vp: 9.00, earnBase: 178.00, literature: 147.00, retail: 194.00 },
            '0379': { name: 'æ—¥æ—¥æ»‹é¤Šè˜†è–ˆæ½¤è†šå•«å–± Herbal Aloe Everyday Soothing Gel', vp: 9.00, earnBase: 178.00, literature: 147.00, retail: 194.00 },
            '0493': { name: 'æ—¥æ—¥æ½¤è†šè˜†è–ˆæ²æµ´éœ² Herbal Aloe Everyday Body Wash', vp: 12.95, earnBase: 186.00, literature: 153.00, retail: 204.00 },
            '2631': { name: 'æ¿ƒç¸®è˜†è–ˆæ±(æŸ‘æ©˜å‘³) Herbal Aloe Concentrate - Mandarin Flavor', vp: 24.95, earnBase: 401.00, literature: 107.00, retail: 439.00 },
            '1463': { name: 'H24 CR7 æ°´å¥åŠ› Herbalife24 CR7 DRIVE - ACAI', vp: 24.90, earnBase: 400.00, literature: 997.00, retail: 462.00 },
            '0210': { name: 'ç”²æ®¼çº–ç¶­ç´  Chitosan Fibre Complex', vp: 24.05, earnBase: 500.00, literature: 406.00, retail: 547.00 },
            '0141': { name: 'ç‡Ÿé¤Šè›‹ç™½ç´  - é›²å‘¢æ‹¿ Nutritional Protein Drink Mix - Vanilla', vp: 23.95, earnBase: 418.00, literature: 339.00, retail: 457.00 },
            '0767': { name: 'æ´»é¤Šè‰æœ¬çˆ½è†šæ°´ Herbalife SKIN ENERGIZING HERBAL TONER', vp: 12.70, earnBase: 208.00, literature: 172.00, retail: 228.00 },
            '0142': { name: 'ç‡Ÿé¤Šè›‹ç™½ç´  - æœ±å¤åŠ› Nutritional Protein Drink Mix - Dutch Chocolate', vp: 23.95, earnBase: 418.00, literature: 339.00, retail: 457.00 },
            '0143': { name: 'ç‡Ÿé¤Šè›‹ç™½ç´  - é‡è‰è“ Nutritional Protein Drink Mix - Wild Berry', vp: 23.95, earnBase: 418.00, literature: 339.00, retail: 457.00 },
            '0146': { name: 'ç‡Ÿé¤Šè›‹ç™½ç´  - æ›²å¥‡å¦™è¶£ Nutritional Protein Drink Mix - Cookies\'n Cream', vp: 23.95, earnBase: 418.00, literature: 339.00, retail: 457.00 },
            '2774': { name: 'ç‡Ÿé¤Šè›‹ç™½ç´  - é®®å¥¶å’–å•¡ Nutritional Protein Drink Mix - CafÃ© Latte', vp: 23.95, earnBase: 418.00, literature: 107.00, retail: 457.00 },
            '0772': { name: 'é‡è“ç£¨ç ‚ä¹³ Herbalife SKIN INSTANT REVEAL BERRY SCRUB', vp: 13.10, earnBase: 214.00, literature: 177.00, retail: 234.00 },
            '0773': { name: 'æ·±å±¤æ½”æ·¨è–„è·é¢è†œ Herbalife SKIN PURIFYING MINT CLAY MASK', vp: 14.20, earnBase: 234.00, literature: 194.00, retail: 256.00 },
            '2789': { name: 'ç‡Ÿé¤Šè›‹ç™½ç´  - è–„è·æœ±å¤åŠ› Nutritional Protein Drink Mix - Mint Chocolate', vp: 23.95, earnBase: 418.00, literature: 325.00, retail: 457.00 },
            '0139': { name: 'éœ²æ€æŠ—æ°§åŒ–ç²¾è¯ RoseGuard', vp: 23.75, earnBase: 383.00, literature: 311.00, retail: 419.00 },
            '1405': { name: 'è£œæ°´24 Herbalife24 Hydrate', vp: 23.60, earnBase: 289.00, literature: 325.00, retail: 368.00 },
            '0079': { name: 'ç¾çº–ç‰‡ Snack Defense', vp: 23.50, earnBase: 489.00, literature: 397.00, retail: 535.00 },
            '2864': { name: 'ç‡Ÿé¤Šçº–ç¶­ç²‰(è˜‹æœå‘³) Active Fiber Complex (Apple Flavor)', vp: 22.95, earnBase: 377.00, literature: 339.00, retail: 413.00 },
            '1065': { name: 'æ¿ƒç¸®è˜†è–ˆæ±(èŠ’æœå‘³) Herbal Aloe Concentrate Mango', vp: 24.95, earnBase: 395.00, literature: 416.00, retail: 432.00 },
            '2865': { name: 'ç‡Ÿé¤Šçº–ç¶­ç²‰(åŸå‘³) Active Fiber Complex (Original Flavor)', vp: 22.95, earnBase: 377.00, literature: 339.00, retail: 413.00 },
            '072K': { name: 'ç‡Ÿé¤Šè›‹ç™½ç´ â”€ç²¾é¸é…æ–¹ Formula 1 Select Nutritional Protein Drink Mix -Natural Vanilla', vp: 21.65, earnBase: 420.00, literature: 460.00, retail: 460.00 }, 
            '1829': { name: 'ç›Šç”ŸèŒ SIMPLY PROBIOTIC', vp: 20.45, earnBase: 337.00, literature: 325.00, retail: 369.00 },
            '0257': { name: 'å³æº¶è‰æœ¬é£²å“50å…‹ - èœœæ¡ƒå‘³ Herbal Tea Concentrate 51g - Peach', vp: 19.95, earnBase: 341.00, literature: 278.00, retail: 373.00 },
            '3115': { name: 'å¤šç¨®ç¶­ä»–å‘½ F2 Multivitamin Complex', vp: 19.95, earnBase: 332.00, literature: 220.00, retail: 363.00 },
            '0212': { name: 'é¦™è’œç‰‡ Mega Garlic Plus', vp: 18.95, earnBase: 250.00, literature: 203.00, retail: 273.00 },
            '0242': { name: 'ä½³èƒ½è›‹ç™½è³ªç²‰ Performance Protein Powder', vp: 17.95, earnBase: 333.00, literature: 270.00, retail: 364.00 },
            '0765': { name: 'è˜†è–ˆèˆ’ç·©æ½”é¢ä¹³ (ä¸­è‡³ä¹¾æ€§è‚Œè†š) Herbalife SKIN SOOTHING ALOE CLEANSER (Normal to Dry)', vp: 16.75, earnBase: 282.00, literature: 228.00, retail: 308.00 },
            '0766': { name: 'é–ƒäº®æŸ‘æ©˜æ½”é¢ä¹³ (ä¸­è‡³æ²¹æ€§è‚Œè†š) Herbalife SKIN POLISHING CITRUS CLEANSER (Normal to Oily)', vp: 16.75, earnBase: 282.00, literature: 228.00, retail: 308.00 },
            '2871': { name: 'LiftoffÂ® èƒ½é‡é£²å“ - æª¸æª¬-é’æª¸å‘³ LiftoffÂ® Effervescent Energy Drink - Lemon-Lime Blast', vp: 15.95, earnBase: 271.00, literature: 306.00, retail: 296.00 },
            '2872': { name: 'LiftoffÂ® èƒ½é‡é£²å“ - é¦™æ©™å‘³ LiftoffÂ® Effervescent Energy Drink - Ignite-Me Orange', vp: 15.95, earnBase: 271.00, literature: 296.00, retail: 296.00 }, 
            '0111': { name: 'æ¶ˆè„‚ç‰‡ Cell-U-LossÂ®', vp: 15.75, earnBase: 250.00, literature: 204.00, retail: 274.00 },
            '0022': { name: 'äº”å‘³å­ç²¾è¯ Schizandra Plus', vp: 15.50, earnBase: 297.00, literature: 270.00, retail: 325.00 },
            '0130': { name: 'æŠ—è„‚ç‰‡ Lipobond', vp: 15.40, earnBase: 330.00, literature: 267.00, retail: 361.00 },
            '0102': { name: 'å¤©ç„¶ç“œæ‹‰æ‹¿èŒ¶ N-R-GÂ® Tea', vp: 14.75, earnBase: 291.00, literature: 237.00, retail: 318.00 },
            '1579': { name: 'è“ä¹‹å¯¶ Triple Berry Complex', vp: 13.25, earnBase: 250.00, literature: 325.00, retail: 274.00 },
            '0565': { name: 'è¤‡åˆéˆ£ç‰‡ Xtra-CalÂ®', vp: 10.70, earnBase: 195.00, literature: 158.00, retail: 213.00 },
            '145K': { name: 'ç¦¦ä¹‹å¯¶ - é»‘åŠ ä¾–å­å‘³ ImmuLift - Blackcurrant', vp: 10.00, earnBase: 175.00, literature: 0.00, retail: 191.00 },
            '202K': { name: 'é‹…ç¶­æ€ - å¤©ç„¶é¦™æ©™èœœç³–å‘³ Best Defense - Honey Orange', vp: 9.95, earnBase: 172.00, literature: 0.00, retail: 188.00 },
            '111K': { name: 'Vitamin Mask â€“ Moisturizing ç¶­ä»–å‘½é¢è†œ â€“ ä¿æ¿•', vp: 8.40, earnBase: 144.00, literature: 168.00, retail: 168.00 }, 
            '2561': { name: 'è˜†è–ˆæ»‹æ½¤æ·‹æµ´éœ² Herbal Aloe Hand & Body Wash', vp: 8.30, earnBase: 131.00, literature: 275.00, retail: 143.00 },
            '4974': { name: 'ç‡Ÿé¤Šè›‹ç™½ç´  - èŠ’æœ Nutritional Protein Drink Mix - Fruity Mango', vp: 23.95, earnBase: 411.00, literature: 220.00, retail: 449.00 },
            '2562': { name: 'è˜†è–ˆæ½¤è†šå•«å–± Herbal Aloe Soothing Gel', vp: 8.30, earnBase: 131.00, literature: 143.00, retail: 143.00 }, 
            '012K': { name: 'å„ªè³ªè›‹ç™½å’–å•¡ - é®®å¥¶å’–å•¡å‘³ High Protein Iced Coffee - Latte', vp: 25.95, earnBase: 430.00, literature: 67.00, retail: 470.00 },
            '2563': { name: 'è˜†è–ˆæ»‹æ½¤ä¹³éœœ Herbal Aloe Hand & Body Cream', vp: 8.30, earnBase: 131.00, literature: 143.00, retail: 143.00 }, 
            '2564': { name: 'æ—¥æ—¥å¼·éŸŒè˜†è–ˆæ´—é«®éœ² HERBAL ALOE SHAMPOO', vp: 8.30, earnBase: 131.00, literature: 143.00, retail: 143.00 }, 
            '112K': { name: 'Vitamin Mask â€“ Brightening ç¶­ä»–å‘½é¢è†œ â€“ ç¾ç™½', vp: 15.55, earnBase: 259.00, literature: 283.00, retail: 283.00 }, 
            '2565': { name: 'æ—¥æ—¥å¼·éŸŒè˜†è–ˆè­·é«®ä¹³ HERBAL ALOE CONDITIONER', vp: 8.30, earnBase: 131.00, literature: 143.00, retail: 143.00 }, 
            '163A': { name: 'ä¸‰å¤©é«”é©—å¥—è£ 3 Days Trail Pack', vp: 7.80, earnBase: 149.00, literature: 0.00, retail: 166.00 },
            '0258': { name: 'è›‹ç™½æ£’ - é›²å‘¢æ‹¿æä» Protein Bar - VANILLA ALMOND', vp: 7.70, earnBase: 116.00, literature: 94.00, retail: 211.00 }
        };
        // ==========================================================

        const FIXED_SHIPPING_FEE = 30.00; 
        const QUICK_FILL_SKUS = ['0141', '0006', '0102', '0242']; 
        
        // é‹è²»è¦å‰‡é–¾å€¼
        const SHIPPING_THRESHOLDS = {
            'distributor': 4000.00, 
            'pc': 2500.00,          
            'retail': 2500.00 // æ–°å¢ï¼šé›¶å”®å®¢é‹è²»é–€æª»
        };

        let currentClientType = 'distributor'; 

        // --- åˆå§‹åŒ– ---
        document.addEventListener('DOMContentLoaded', () => {
            addRow(); 
            calculateTotals();
            setClientType('distributor'); 
        });

        // --- è¨­ç½®å®¢æˆ¶èº«ä»½ ---
        function setClientType(type) {
            currentClientType = type;
            const btnDistributor = document.getElementById('btn-distributor');
            const btnPC = document.getElementById('btn-pc');
            const btnRetail = document.getElementById('btn-retail'); 
            const ruleDisplay = document.getElementById('shipping-rule-display');
            const clientTypeText = document.getElementById('client-type-text');
            const discountSelect = document.getElementById('discountLevel');
            
            // è™•ç†æŒ‰éˆ•æ¿€æ´»ç‹€æ…‹
            btnDistributor.classList.toggle('active', type === 'distributor');
            btnPC.classList.toggle('active', type === 'pc');
            btnRetail.classList.toggle('active', type === 'retail');
            
            // è™•ç†æŠ˜æ‰£é¸æ“‡å™¨ç‹€æ…‹
            if (type === 'retail') {
                discountSelect.value = '0.00'; // å¼·åˆ¶ 0% æŠ˜æ‰£ (åŸåƒ¹)
                discountSelect.disabled = true;
                discountSelect.style.backgroundColor = '#f8d7da'; // æ·ºç´…èƒŒæ™¯æç¤ºç¦ç”¨
                clientTypeText.textContent = 'é›¶å”®å®¢';
                ruleDisplay.innerHTML = `é‹è²»è¦å‰‡: é›¶å”®å®¢è¨‚å–®**é›¶å”®ç¸½åƒ¹ HK$ ${SHIPPING_THRESHOLDS.retail.toFixed(2)} ä»¥ä¸‹**ï¼Œé‹è²» HK$ ${FIXED_SHIPPING_FEE.toFixed(2)}`;
            } else {
                discountSelect.disabled = false;
                discountSelect.style.backgroundColor = 'white'; 
                if (type === 'distributor') {
                    clientTypeText.textContent = 'ç›´éŠ·å•†';
                    ruleDisplay.innerHTML = `é‹è²»è¦å‰‡: ç›´éŠ·å•†è¨‚å–®**é›¶å”®ç¸½åƒ¹ HK$ ${SHIPPING_THRESHOLDS.distributor.toFixed(2)} ä»¥ä¸‹**ï¼Œé‹è²» HK$ ${FIXED_SHIPPING_FEE.toFixed(2)}`;
                } else { // pc
                    clientTypeText.textContent = 'å„ªæƒ å®¢æˆ¶';
                    ruleDisplay.innerHTML = `é‹è²»è¦å‰‡: å„ªæƒ å®¢æˆ¶è¨‚å–®**é›¶å”®ç¸½åƒ¹ HK$ ${SHIPPING_THRESHOLDS.pc.toFixed(2)} ä»¥ä¸‹**ï¼Œé‹è²» HK$ ${FIXED_SHIPPING_FEE.toFixed(2)}`;
                }
                // å¦‚æœä¹‹å‰ç‚ºé›¶å”®å®¢ï¼Œå‰‡å°‡æŠ˜æ‰£é‡ç½®ç‚ºé è¨­å€¼
                if (discountSelect.value === '0.00') {
                    discountSelect.value = '0.25'; 
                }
            }

            calculateTotals();
        }

        // --- æ ¸å¿ƒæŸ¥æ‰¾å‡½æ•¸ (SKU Lookup) ---
        function lookupProduct(inputElement) {
            const sku = inputElement.value.toUpperCase().replace(/[^A-Z0-9]/g, '').trim(); 
            inputElement.value = sku; 
            const row = inputElement.closest('tr');
            const product = productDatabase[sku];

            const productName = row.cells[3].querySelector('input');
            const vp = row.cells[4].querySelector('[data-field="vp"]');
            const earnBase = row.cells[5].querySelector('[data-field="earnBase"]');
            const literaturePrice = row.cells[6].querySelector('[data-field="literaturePrice"]');
            const retailPrice = row.cells[7].querySelector('[data-field="retailPrice"]');

            if (product) {
                productName.value = product.name;
                vp.value = product.vp;
                earnBase.value = product.earnBase;
                literaturePrice.value = product.literature;
                retailPrice.value = product.retail;
            } else {
                productName.value = 'æœªæ‰¾åˆ°';
                vp.value = 0;
                earnBase.value = 0;
                literaturePrice.value = 0;
                retailPrice.value = 0;
            }
            calculateTotals(); 
        }

        // --- è¼”åŠ©å‡½æ•¸ (Add/Remove Row, Quick Fill, Search) ---
        function addRow(sku = '', qty = 1) {
            const tableBody = document.querySelector('#productTable tbody');
            const newRow = tableBody.insertRow();
            newRow.innerHTML = `
                <td><button class="remove-btn" onclick="removeRow(this)">ç§»é™¤</button></td>
                <td><input type="text" class="sku-input" onchange="lookupProduct(this)" placeholder="è¼¸å…¥SKU" value="${sku}" ></td>
                <td><input type="number" class="qty-input" min="1" value="${qty}" oninput="calculateTotals()"></td>
                <td><input type="text" class="read-only" readonly value="---"></td>
                <td><input type="number" class="read-only" readonly value="0" data-field="vp"></td>
                <td><input type="number" class="read-only" readonly value="0" data-field="earnBase"></td>
                <td><input type="number" class="read-only" readonly value="0" data-field="literaturePrice"></td>
                <td><input type="number" class="read-only" readonly value="0" data-field="retailPrice"></td>
            `;
            if (sku) {
                lookupProduct(newRow.cells[1].querySelector('.sku-input'));
            } else {
                calculateTotals();
            }
        }
        function removeRow(buttonElement) {
            const row = buttonElement.closest('tr');
            row.remove();
            calculateTotals();
        }
        function quickFill() {
            const tableBody = document.querySelector('#productTable tbody');
            tableBody.innerHTML = '';
            QUICK_FILL_SKUS.forEach(sku => { addRow(sku.toUpperCase(), 1); });
            calculateTotals();
        }
        function performSearch() {
            const searchTerm = document.getElementById('productNameSearch').value.toUpperCase().trim();
            const resultsDiv = document.getElementById('searchResults');
            resultsDiv.innerHTML = '';
            
            if (searchTerm.length < 2) {
                resultsDiv.innerHTML = '<p style="color: red; margin: 0;">è«‹è¼¸å…¥è‡³å°‘ 2 å€‹é—œéµå­—é€²è¡Œæœå°‹ã€‚</p>';
                resultsDiv.style.display = 'block';
                return;
            }

            let found = false;
            for (const sku in productDatabase) {
                const product = productDatabase[sku];
                // æœå°‹ç”¢å“åç¨±æˆ– SKU
                if (product.name.toUpperCase().includes(searchTerm) || sku.includes(searchTerm)) {
                    found = true;
                    const resultItem = document.createElement('div');
                    resultItem.innerHTML = `
                        <span style="font-weight: bold;">[${sku}]</span> ${product.name} 
                        <span style="color: #007bff;">(é›¶å”®åƒ¹: HK$ ${product.retail.toFixed(2)})</span>
                        <button onclick="addProductFromSearch('${sku}')" style="margin-left: 15px; background: #28a745; color: white; border: none; padding: 4px 8px; cursor: pointer; border-radius: 3px;">åŠ å…¥</button>
                    `;
                    resultItem.style.padding = '5px 0';
                    resultItem.style.borderBottom = '1px dotted #eee';
                    resultsDiv.appendChild(resultItem);
                }
            }

            if (!found) {
                resultsDiv.innerHTML = '<p style="color: #6c757d; margin: 0;">æœªæ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„ç”¢å“ã€‚è«‹å˜—è©¦ä¸åŒçš„é—œéµå­—ã€‚</p>';
            }

            resultsDiv.style.display = 'block';
        }
        function addProductFromSearch(sku) {
            addRow(sku, 1);
            document.getElementById('searchResults').style.display = 'none';
            document.getElementById('productNameSearch').value = ''; 
        }
        
        // --- æ ¸å¿ƒç¸½è¨ˆç®—å‡½æ•¸ ---
        function calculateTotals() {
            const rows = document.querySelectorAll('#productTable tbody tr');
            let totalVP = 0;
            let totalEarnBase = 0;
            let overallTotalRetail = 0; 

            const discountLevelElement = document.getElementById('discountLevel');
            let discountFactor = parseFloat(discountLevelElement.value); 
            
            // ** é›¶å”®å®¢é‚è¼¯è¦†è“‹ **
            if (currentClientType === 'retail') {
                discountFactor = 0.00; // å¼·åˆ¶ 0% æŠ˜æ‰£
            }

            const discountPercentage = (discountFactor * 100).toFixed(0) + '%'; 

            rows.forEach(row => {
                const qty = parseInt(row.cells[2].querySelector('.qty-input').value) || 0;
                const vp = parseFloat(row.cells[4].querySelector('[data-field="vp"]').value) || 0;
                const earnBase = parseFloat(row.cells[5].querySelector('[data-field="earnBase"]').value) || 0;
                const retailPrice = parseFloat(row.cells[7].querySelector('[data-field="retailPrice"]').value) || 0;

                totalVP += vp * qty;
                totalEarnBase += earnBase * qty;
                overallTotalRetail += retailPrice * qty;
            });
            
            // 1. è¨ˆç®—ç¸½æŠ˜æ‰£é‡‘é¡: ç¸½æ”¶å…¥åŸºæ•¸ x æŠ˜æ‰£ç‡
            const totalDiscountAmount = totalEarnBase * discountFactor;

            // 2. æœ€çµ‚å®¢æˆ¶æ‡‰ä»˜ç”¢å“ç¸½åƒ¹ (æœƒå“¡åƒ¹/é›¶å”®åƒ¹)
            const finalProductTotal = overallTotalRetail - totalDiscountAmount;

            // 3. é‹è²»è‡ªå‹•åˆ¤å®š
            let appliedShippingFee = FIXED_SHIPPING_FEE;
            const threshold = SHIPPING_THRESHOLDS[currentClientType];

            if (overallTotalRetail > threshold) {
                appliedShippingFee = 0.00; // å…é‹è²»
            } else if (overallTotalRetail === 0) {
                 appliedShippingFee = 0.00; // é›¶è¨‚å–®ä¹Ÿå…é‹
            } else {
                appliedShippingFee = FIXED_SHIPPING_FEE; // æ”¶å–é‹è²»
            }

            // 4. æ‡‰æ”¶ç¸½é‡‘é¡ (ç”¢å“ç¸½åƒ¹ + é‹è²»)
            const totalAmountDue = finalProductTotal + appliedShippingFee;

            // --- æ›´æ–°ç¸½çµå€å¡Š ---
            document.getElementById('sum-vp').textContent = totalVP.toFixed(2);
            document.getElementById('sum-earnBase').textContent = totalEarnBase.toFixed(2);
            document.getElementById('sum-totalRetail').textContent = `HK$ ${overallTotalRetail.toFixed(2)}`;
            
            // æ ¹æ“šæ˜¯å¦ç‚ºé›¶å”®å®¢èª¿æ•´æŠ˜æ‰£é¡¯ç¤º
            const discountDisplay = document.getElementById('discount-display');
            if (currentClientType === 'retail') {
                discountDisplay.textContent = '0%';
                document.getElementById('sum-discountAmount').textContent = `- HK$ 0.00 (åŸåƒ¹)`;
            } else {
                discountDisplay.textContent = discountPercentage;
                document.getElementById('sum-discountAmount').textContent = `- HK$ ${totalDiscountAmount.toFixed(2)}`;
            }

            document.getElementById('sum-shipping').textContent = `HK$ ${appliedShippingFee.toFixed(2)} (${overallTotalRetail > 0 && overallTotalRetail > threshold ? 'å…é‹' : overallTotalRetail > 0 ? 'æ”¶å–' : '---'})`;
            document.getElementById('sum-totalDue').textContent = `HK$ ${totalAmountDue.toFixed(2)}`;
        }


        // --- ç”Ÿæˆåˆ—å°ç”¨è¨‚å–®è¡¨åŠŸèƒ½ ---
        function generatePrintOrder() {
            const tableBody = document.querySelector('#productTable tbody');
            const rows = tableBody.querySelectorAll('tr');
            let orderItemsHtml = '';
            
            calculateTotals(); 

            // å¾ DOM å–å¾—æœ€çµ‚è¨ˆç®—çµæœ
            const totalVP = parseFloat(document.getElementById('sum-vp').textContent);
            const overallTotalRetail = parseFloat(document.getElementById('sum-totalRetail').textContent.replace('HK$', '').trim());
            const totalDiscountAmountText = document.getElementById('sum-discountAmount').textContent.replace('- HK$', '').replace('(åŸåƒ¹)', '').trim();
            const totalDiscountAmount = parseFloat(totalDiscountAmountText);
            const shippingText = document.getElementById('sum-shipping').textContent;
            const appliedShippingFee = parseFloat(shippingText.split('(')[0].replace('HK$', '').trim());
            const totalAmountDue = parseFloat(document.getElementById('sum-totalDue').textContent.replace('HK$', '').trim());
            const finalProductTotal = totalAmountDue - appliedShippingFee;
            const discountPercentage = document.getElementById('discount-display').textContent;
            const clientTypeText = document.getElementById('client-type-text').textContent;
            
            // å»ºç«‹è¨‚å–®æ˜ç´° HTML
            rows.forEach(row => {
                const sku = row.cells[1].querySelector('.sku-input').value.toUpperCase().trim();
                const qty = parseInt(row.cells[2].querySelector('.qty-input').value) || 0;
                const productName = row.cells[3].querySelector('input').value;
                const retailPrice = parseFloat(row.cells[7].querySelector('[data-field="retailPrice"]').value) || 0;
                const vp = parseFloat(row.cells[4].querySelector('[data-field="vp"]').value) || 0;
                
                if (sku && qty > 0 && productName !== 'æœªæ‰¾åˆ°') {
                    const lineRetailTotal = retailPrice * qty;
                    const lineVP = vp * qty;

                    orderItemsHtml += `
                        <tr>
                            <td>${sku}</td>
                            <td style="text-align: left;">${productName}</td>
                            <td>${qty}</td>
                            <td>${lineVP.toFixed(2)}</td>
                            <td>${retailPrice.toFixed(2)}</td>
                            <td>${lineRetailTotal.toFixed(2)}</td>
                        </tr>
                    `;
                }
            });

            if (!orderItemsHtml) {
                alert('è¨‚å–®ä¸­æ²’æœ‰æœ‰æ•ˆç”¢å“ï¼Œç„¡æ³•ç”Ÿæˆè¨‚å–®è¡¨ã€‚');
                return;
            }

            // è¨‚å–®è¡¨ HTML æ¨¡æ¿
            const printWindowContent = `
                <html>
                <head>
                    <title>è¨‚å–®æ‘˜è¦ - ${clientTypeText} (${discountPercentage})</title>
                    <style>
                        body { font-family: 'Arial', sans-serif; margin: 30px; }
                        h2 { color: #007bff; border-bottom: 2px solid #007bff; padding-bottom: 5px; margin-bottom: 20px; }
                        table { width: 100%; border-collapse: collapse; margin-bottom: 30px; }
                        th, td { border: 1px solid #000; padding: 8px; text-align: center; font-size: 12px; }
                        th { background-color: #f2f2f2; }
                        .summary-table td { border: none; padding: 5px 0; }
                        .final-total { background-color: #dc3545; color: white; font-weight: bold; font-size: 16px; }
                        .info-box { border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; background-color: #f9f9f9; }
                    </style>
                </head>
                <body>
                    <h2>è¨‚å–®æ‘˜è¦ (${clientTypeText} - ${discountPercentage} æŠ˜æ‰£)</h2>

                    <div class="info-box">
                        ${clientTypeText === 'é›¶å”®å®¢' ? '**é›¶å”®å®¢è¨ˆåƒ¹å…¬å¼**: åƒ¹æ ¼ Retail + é‹è²»' : '**æœƒå“¡åƒ¹æ ¼è¨ˆç®—å…¬å¼**: åƒ¹æ ¼ Retail - (æ”¶å…¥åŸºæ•¸ Earn Base Ã— æŠ˜æ‰£é¡ Discount%)'}
                        <br>
                        **é‹è²»è¦å‰‡**: ${document.getElementById('shipping-rule-display').textContent.replace('é‹è²»è¦å‰‡: ', '')}
                    </div>

                    <table>
                        <thead>
                            <tr>
                                <th>SKU</th>
                                <th>ç”¢å“åç¨±</th>
                                <th>æ•¸é‡</th>
                                <th>ç¸½ VP</th>
                                <th>é›¶å”®å–®åƒ¹</th>
                                <th>é›¶å”®ç¸½åƒ¹</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${orderItemsHtml}
                        </tbody>
                    </table>

                    <table class="summary-table" style="width: 40%; float: right;">
                        <tr>
                            <td style="text-align: right; width: 60%;">ç¸½éŠ·å”®é‡é»æ•¸ (VP):</td>
                            <td style="text-align: right; font-weight: bold; color: #009688;">${totalVP.toFixed(2)}</td>
                        </tr>
                        <tr>
                            <td style="text-align: right;">ç¸½é›¶å”®åƒ¹æ ¼ (æœªæŠ˜):</td>
                            <td style="text-align: right;">HK$ ${overallTotalRetail.toFixed(2)}</td>
                        </tr>
                        <tr>
                            <td style="text-align: right; color: ${totalDiscountAmount > 0 ? '#dc3545' : '#000'};">ç¸½æŠ˜æ‰£é‡‘é¡ (${discountPercentage}):</td>
                            <td style="text-align: right; color: ${totalDiscountAmount > 0 ? '#dc3545' : '#000'};">- HK$ ${totalDiscountAmount.toFixed(2)}</td>
                        </tr>
                        <tr>
                            <td style="text-align: right; border-top: 1px solid #000;">æ·¨ç”¢å“é‡‘é¡ (${clientTypeText === 'é›¶å”®å®¢' ? 'åŸåƒ¹' : 'æœƒå“¡åƒ¹'}):</td>
                            <td style="text-align: right; border-top: 1px solid #000; font-weight: bold;">HK$ ${finalProductTotal.toFixed(2)}</td>
                        </tr>
                        <tr>
                            <td style="text-align: right;">é‹è²»:</td>
                            <td style="text-align: right;">HK$ ${appliedShippingFee.toFixed(2)}</td>
                        </tr>
                        <tr class="final-total">
                            <td style="text-align: right;">**å®¢æˆ¶æ‡‰ä»˜ç¸½é‡‘é¡ (å«é‹è²»):**</td>
                            <td style="text-align: right;">**HK$ ${totalAmountDue.toFixed(2)}**</td>
                        </tr>
                    </table>
                    <div style="clear: both;"></div>
                </body>
                </html>
            `;

            const printWindow = window.open('', '_blank');
            printWindow.document.write(printWindowContent);
            printWindow.document.close();
            printWindow.focus();
        }
    </script>

</body>
</html>
