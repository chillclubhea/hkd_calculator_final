<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”¢å“åˆ†ç´šæŠ˜æ‰£èˆ‡é»æ•¸è¨ˆç®—å·¥å…· (HKD - æœƒå“¡åƒ¹)</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f7f6;
            padding: 20px;
            color: #333;
        }
        .container {
            max-width: 1300px;
            margin: 0 auto;
            background-color: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #007bff;
            text-align: center;
            margin-bottom: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
            font-size: 13px;
        }
        th {
            background-color: #e9ecef;
            color: #333;
            font-weight: 600;
        }
        .sku-input, .qty-input {
            width: 90%;
            padding: 6px;
            border: 1px solid #ccc;
            border-radius: 3px;
            box-sizing: border-box;
        }
        .read-only {
            background-color: #f8f9fa;
            color: #555;
            font-weight: bold;
        }
        .add-btn, .quick-input-btn {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 20px;
            float: right;
            margin-left: 10px;
        }
        .quick-input-btn {
            background-color: #ffc107;
            color: #333;
        }
        /* ç¸½çµå€å¡Šæ¨£å¼ */
        .summary-box {
            background-color: #fff;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }
        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px dashed #eee;
            font-size: 16px;
        }
        .total-due {
            margin-top: 15px;
            background-color: #007bff;
            color: white;
            padding: 12px;
            border-radius: 4px;
            font-size: 20px;
            text-align: center;
        }
        #searchResults {
            padding: 10px;
            border: 1px dashed #ccc;
            background-color: #ffffff;
            border-radius: 4px;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>ç”¢å“åˆ†ç´šæŠ˜æ‰£èˆ‡é»æ•¸è¨ˆç®—å·¥å…· (HKD æ¸¯å¹£)</h1>

        <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 6px; display: flex; justify-content: space-between; align-items: center;">
            <div>
                <label for="discountLevel" style="font-weight: bold; margin-right: 15px;">è«‹é¸æ“‡æœ¬æ¬¡è¨‚å–®çš„æŠ˜æ‰£ç´šåˆ¥:</label>
                <select id="discountLevel" onchange="calculateTotals()" style="padding: 8px; border-radius: 4px;">
                    <option value="0.15" selected>15% æŠ˜æ‰£</option> 
                    <option value="0.25">25% æŠ˜æ‰£</option>
                    <option value="0.35">35% æŠ˜æ‰£</option>
                    <option value="0.42">42% æŠ˜æ‰£</option>
                    <option value="0.50">50% æŠ˜æ‰£</option>
                </select>
            </div>
            <div style="font-weight: bold; color: #dc3545; display: flex; align-items: center;">
                é‹è²»: HK$ 30.00
                <button id="toggleShippingBtn" onclick="toggleShipping()" style="margin-left: 15px; padding: 5px 10px; border: none; border-radius: 4px; cursor: pointer; background-color: #f0ad4e; color: white;">ä¸åŠ å…¥é‹è²»</button>
            </div>
        </div>
        
        <div style="margin-bottom: 20px; padding: 15px; background: #e6f7ff; border-radius: 6px;">
            <label for="productNameSearch" style="font-weight: bold; margin-right: 15px;">ğŸ” ç”¢å“åç¨±æœå°‹:</label>
            <input type="text" id="productNameSearch" placeholder="è¼¸å…¥ç”¢å“åç¨±é—œéµå­— (è‡³å°‘ 2 å€‹å­—)" style="padding: 6px; width: 300px;">
            <button class="add-btn" style="float: none; margin-left: 10px; background-color: #007bff;" onclick="performSearch()">æœå°‹</button>
            <div id="searchResults" style="margin-top: 10px; display: none;">
                </div>
        </div>

        <div style="margin-bottom: 20px;">
            <button class="add-btn" onclick="addRow()">+ æ–°å¢ç”¢å“</button>
            <button class="quick-input-btn" onclick="quickFill()">4æ¯æ°´</button>
            <div style="clear: both;"></div>
        </div>
        
        <table id="productTable">
            <thead>
                <tr>
                    <th rowspan="2">æ“ä½œ</th>
                    <th rowspan="2">ç”¢å“ç·¨è™Ÿ (SKU)</th>
                    <th rowspan="2">æ•¸é‡ (Qty)</th>
                    <th rowspan="2">ç”¢å“åç¨±</th>
                    <th colspan="2">ç©é»/åŸºæ•¸</th>
                    <th colspan="2">åƒ¹æ ¼ (HK$)</th>
                </tr>
                <tr>
                    <th>éŠ·å”®é‡é»æ•¸ (VP)</th>
                    <th>æ”¶å…¥åŸºæ•¸ (Earn Base)</th>
                    <th>è¼”éŠ·å“åƒ¹æ ¼ (Literature Price)</th>
                    <th>é›¶å”®åƒ¹æ ¼ (Retail)</th>
                </tr>
            </thead>
            <tbody>
                </tbody>
        </table>

        <div style="clear: both;"></div>

        <h2>è¨‚å–®ç¸½çµèˆ‡è¨ˆç®—çµæœ</h2>
        <div class="summary-box">
            <div class="summary-item">
                <span class="label">ç¸½éŠ·å”®é‡é»æ•¸ (VP)</span>
                <span id="sum-vp" class="value" style="color: #009688;">0.00</span>
            </div>
            <div class="summary-item">
                <span class="label">ç¸½æ”¶å…¥åŸºæ•¸ (Earn Base)</span>
                <span id="sum-earnBase" class="value">0.00</span>
            </div>
            <div class="summary-item">
                <span class="label">ç¸½é›¶å”®åƒ¹æ ¼ (æœªæŠ˜)</span>
                <span id="sum-totalRetail" class="value">HK$ 0.00</span>
            </div>
            <div class="summary-item" style="font-size: 18px; background: #ffebee;">
                <span class="label">ç¸½æŠ˜æ‰£é‡‘é¡ (<span id="discount-display">25%</span>, **åŸºæ–¼ç¸½æ”¶å…¥åŸºæ•¸è¨ˆç®—**)</span>
                <span id="sum-discountAmount" class="value" style="color: #dc3545;">- HK$ 0.00</span>
            </div>
            <div class="summary-item">
                <span class="label">é‹è²»</span>
                <span id="sum-shipping" class="value">HK$ 30.00</span>
            </div>
            <div class="summary-item total-due">
                <span class="label">å®¢æˆ¶æ‡‰æ”¶ç¸½é‡‘é¡ (å«é‹è²»)</span>
                <span id="sum-totalDue" class="value">HK$ 0.00</span>
            </div>
        </div>
    </div>

    <script>
        const SHIPPING_FEE = 30.00; // æ¸¯å¹£é‹è²» $30.00
        const QUICK_FILL_SKUS = ['0141', '0006', '0102', '0242']; // å¿«é€Ÿè¼¸å…¥æ¸…å–®
        let isShippingIncluded = true; // é‹è²»ç‹€æ…‹è®Šæ•¸ (é è¨­åŠ å…¥)

        // ==========================================================
        //  ç”¢å“è³‡æ–™åº« (èˆ‡æ‚¨æä¾›çš„æ•¸æ“šä¸€è‡´)
        // ==========================================================
        const productDatabase = {
            '0006': { name: 'æ¿ƒç¸®è˜†è–ˆæ± Herbal Aloe Concentrate', vp: 24.95, earnBase: 401.00, literature: 0.00, retail: 439.00 },
            '0022': { name: 'äº”å‘³å­ç²¾è¯ Schizandra Plus', vp: 15.50, earnBase: 297.00, literature: 0.00, retail: 325.00 },
            '0036': { name: 'å¤œå¯§æ–°ç‡Ÿé¤Šé£²å“ NiteworksÂ®', vp: 89.95, earnBase: 1490.00, literature: 0.00, retail: 1630.00 },
            '0056': { name: 'è† åŸè›‹ç™½ç¾è‚Œé£²æ–™ Beauty Powder Drink', vp: 43.55, earnBase: 865.00, literature: 0.00, retail: 946.00 },
            '0065': { name: 'æ·±æµ·é­šæ²¹ HerbalifelineÂ®', vp: 25.75, earnBase: 419.00, literature: 0.00, retail: 458.00 },
            '0079': { name: 'ç¾çº–ç‰‡ Snack Defense', vp: 23.50, earnBase: 489.00, literature: 0.00, retail: 535.00 },
            '0100': { name: 'å—æ¥µç£·è¦æ²¹ Krill ShieldÂ®', vp: 35.50, earnBase: 570.00, literature: 0.00, retail: 624.00 },
            '0102': { name: 'å¤©ç„¶ç“œæ‹‰æ‹¿èŒ¶ N-R-GÂ® Tea', vp: 14.75, earnBase: 291.00, literature: 0.00, retail: 318.00 },
            '0106': { name: 'å³æº¶è‰æœ¬é£²å“102å…‹ - åŸå‘³ Herbal Tea Concentrate 102g - Original', vp: 34.95, earnBase: 603.00, literature: 0.00, retail: 660.00 },
            '0111': { name: 'æ¶ˆè„‚ç‰‡ Cell-U-LossÂ®', vp: 15.75, earnBase: 250.00, literature: 0.00, retail: 274.00 },
            '0130': { name: 'æŠ—è„‚ç‰‡ Lipobond', vp: 15.40, earnBase: 330.00, literature: 0.00, retail: 361.00 },
            '0139': { name: 'éœ²æ€æŠ—æ°§åŒ–ç²¾è¯ RoseGuard', vp: 23.75, earnBase: 383.00, literature: 0.00, retail: 419.00 },
            '0141': { name: 'ç‡Ÿé¤Šè›‹ç™½ç´  - é›²å‘¢æ‹¿ Nutritional Protein Drink Mix - Vanilla', vp: 23.95, earnBase: 418.00, literature: 0.00, retail: 457.00 },
            '0142': { name: 'ç‡Ÿé¤Šè›‹ç™½ç´  - æœ±å¤åŠ› Nutritional Protein Drink Mix - Dutch Chocolate', vp: 23.95, earnBase: 418.00, literature: 0.00, retail: 457.00 },
            '0143': { name: 'ç‡Ÿé¤Šè›‹ç™½ç´  - é‡è‰è“ Nutritional Protein Drink Mix - Wild Berry', vp: 23.95, earnBase: 418.00, literature: 0.00, retail: 457.00 },
            '0146': { name: 'ç‡Ÿé¤Šè›‹ç™½ç´  - æ›²å¥‡å¦™è¶£ Nutritional Protein Drink Mix - Cookies\'n Cream', vp: 23.95, earnBase: 418.00, literature: 0.00, retail: 457.00 },
            '0210': { name: 'ç”²æ®¼çº–ç¶­ç´  Chitosan Fibre Complex', vp: 24.05, earnBase: 500.00, literature: 0.00, retail: 547.00 },
            '0212': { name: 'é¦™è’œç‰‡ Mega Garlic Plus', vp: 18.95, earnBase: 250.00, literature: 0.00, retail: 273.00 },
            '0242': { name: 'ä½³èƒ½è›‹ç™½è³ªç²‰ Performance Protein Powder', vp: 17.95, earnBase: 333.00, literature: 0.00, retail: 364.00 },
            '0257': { name: 'å³æº¶è‰æœ¬é£²å“50å…‹ - èœœæ¡ƒå‘³ Herbal Tea Concentrate 51g - Peach', vp: 19.95, earnBase: 341.00, literature: 0.00, retail: 373.00 },
            '0258': { name: 'è›‹ç™½æ£’ - é›²å‘¢æ‹¿æä» Protein Bar - VANILLA ALMOND', vp: 7.70, earnBase: 116.00, literature: 0.00, retail: 211.00 },
            '0565': { name: 'è¤‡åˆéˆ£ç‰‡ Xtra-CalÂ®', vp: 10.70, earnBase: 195.00, literature: 0.00, retail: 213.00 },
            '0759': { name: 'å³æº¶è‰æœ¬é£²å“102å…‹ - è˜‹æœç”˜èŠå‘³ Herbal Tea Concentrate 102g - Apple Chamomile', vp: 34.95, earnBase: 603.00, literature: 0.00, retail: 660.00 },
            '0765': { name: 'è˜†è–ˆèˆ’ç·©æ½”é¢ä¹³ (ä¸­è‡³ä¹¾æ€§è‚Œè†š) Herbalife SKIN SOOTHING ALOE CLEANSER (Normal to Dry)', vp: 16.75, earnBase: 282.00, literature: 0.00, retail: 308.00 },
            '0766': { name: 'é–ƒäº®æŸ‘æ©˜æ½”é¢ä¹³ (ä¸­è‡³æ²¹æ€§è‚Œè†š) Herbalife SKIN POLISHING CITRUS CLEANSER (Normal to Oily)', vp: 16.75, earnBase: 282.00, literature: 0.00, retail: 308.00 },
            '0768': { name: 'æŠ—çšºç²¾è¯éœœ Herbalife SKIN LINE MINIMIZING SERUM', vp: 37.70, earnBase: 629.00, literature: 0.00, retail: 688.00 },
            '0769': { name: 'æ³¨é¡ä¿®è­·æ—¥éœœ Herbalife SKIN DAILY GLOW MOISTURIZER', vp: 28.40, earnBase: 474.00, literature: 0.00, retail: 519.00 },
            '0770': { name: 'ç›ˆäº®ç·Šç·»çœ¼éƒ¨å•«å–± Herbalife SKIN FIRMING EYE GEL', vp: 26.35, earnBase: 441.00, literature: 0.00, retail: 482.00 },
            '0771': { name: 'æ·±å±¤æ»‹æ½¤çœ¼éœœ Herbalife SKIN HYDRATING EYE CREAM', vp: 26.35, earnBase: 441.00, literature: 0.00, retail: 482.00 },
            '0774': { name: 'ä¿®è­·æ™šéœœ Herbalife SKIN REPLENISHING NIGHT CREAM', vp: 28.40, earnBase: 474.00, literature: 0.00, retail: 519.00 },
            '0891': { name: 'æ´»é¤Šè‰æœ¬çˆ½è†šæ°´ - 150 æ¯«å‡ Herbalife SKIN ENERGIZING HERBAL TONER - 150ML', vp: 32.30, earnBase: 540.00, literature: 0.00, retail: 591.00 },
            '0899': { name: 'é˜²æ›¬æ—¥éœœSPF30/PA+++ Protective Moisturizer SPF30/PA+++', vp: 28.40, earnBase: 474.00, literature: 0.00, retail: 519.00 },
            '1000': { name: 'é—œæ·å¯¶ Joint Support', vp: 44.00, earnBase: 749.00, literature: 0.00, retail: 819.00 },
            '1061': { name: 'å¥³å£«ä¹‹é¸ Woman\'s Choice', vp: 37.00, earnBase: 512.00, literature: 0.00, retail: 560.00 },
            '1405': { name: 'è£œæ°´24 Herbalife24 Hydrate', vp: 23.60, earnBase: 289.00, literature: 0.00, retail: 368.00 },
            '1417': { name: 'å¥é«” 24 - æœ±å¤åŠ›å‘³ Herbalife24 Rebuild Strength - Chocolate', vp: 68.45, earnBase: 1028.00, literature: 0.00, retail: 1167.00 },
            '1457': { name: 'ç‡Ÿé¤Šè›‹ç™½ç´  24 - é›²å‘¢æ‹¿å‘³ Herbalife24 Formula 1 Sports - Creamy Vanilla', vp: 41.60, earnBase: 698.00, literature: 0.00, retail: 764.00 },
            '1462': { name: 'é€Ÿå‚™ 24 Herbalife24 Prepare', vp: 73.10, earnBase: 1227.00, literature: 0.00, retail: 1342.00 },
            '1463': { name: 'H24 CR7 æ°´å¥åŠ› Herbalife24 CR7 DRIVE - ACAI', vp: 24.90, earnBase: 400.00, literature: 0.00, retail: 462.00 },
            '1579': { name: 'è“ä¹‹å¯¶ Triple Berry Complex', vp: 13.25, earnBase: 250.00, literature: 0.00, retail: 274.00 },
            '1610': { name: 'æ¿ƒç¸®è˜†è–ˆæ±(è‘¡è„å‘³) Herbal Aloe Concentrate - Grape Flavor', vp: 24.95, earnBase: 401.00, literature: 0.00, retail: 439.00 },
            '1829': { name: 'ç›Šç”ŸèŒ SIMPLY PROBIOTIC', vp: 20.45, earnBase: 337.00, literature: 0.00, retail: 369.00 },
            '2561': { name: 'è˜†è–ˆæ»‹æ½¤æ·‹æµ´éœ² Herbal Aloe Hand & Body Wash', vp: 8.30, earnBase: 131.00, literature: 0.00, retail: 143.00 },
            '2562': { name: 'è˜†è–ˆæ½¤è†šå•«å–± Herbal Aloe Soothing Gel', vp: 8.30, earnBase: 131.00, literature: 0.00, retail: 143.00 },
            '2563': { name: 'è˜†è–ˆæ»‹æ½¤ä¹³éœœ Herbal Aloe Hand & Body Cream', vp: 8.30, earnBase: 131.00, literature: 0.00, retail: 143.00 },
            '2564': { name: 'æ—¥æ—¥å¼·éŸŒè˜†è–ˆæ´—é«®éœ² HERBAL ALOE SHAMPOO', vp: 8.30, earnBase: 131.00, literature: 0.00, retail: 143.00 },
            '2565': { name: 'æ—¥æ—¥å¼·éŸŒè˜†è–ˆè­·é«®ä¹³ HERBAL ALOE CONDITIONER', vp: 8.30, earnBase: 131.00, literature: 0.00, retail: 143.00 },
            '2631': { name: 'æ¿ƒç¸®è˜†è–ˆæ±(æŸ‘æ©˜å‘³) Herbal Aloe Concentrate - Mandarin Flavor', vp: 24.95, earnBase: 401.00, literature: 0.00, retail: 439.00 },
            '2774': { name: 'ç‡Ÿé¤Šè›‹ç™½ç´  - é®®å¥¶å’–å•¡ Nutritional Protein Drink Mix - CafÃ© Latte', vp: 23.95, earnBase: 418.00, literature: 0.00, retail: 457.00 },
            '2789': { name: 'ç‡Ÿé¤Šè›‹ç™½ç´  - è–„è·æœ±å¤åŠ› Nutritional Protein Drink Mix - Mint Chocolate', vp: 23.95, earnBase: 418.00, literature: 0.00, retail: 457.00 },
            '2864': { name: 'ç‡Ÿé¤Šçº–ç¶­ç²‰(è˜‹æœå‘³) Active Fiber Complex (Apple Flavor)', vp: 22.95, earnBase: 377.00, literature: 0.00, retail: 413.00 },
            '2865': { name: 'ç‡Ÿé¤Šçº–ç¶­ç²‰(åŸå‘³) Active Fiber Complex (Original Flavor)', vp: 22.95, earnBase: 377.00, literature: 0.00, retail: 413.00 },
            '2871': { name: 'LiftoffÂ® èƒ½é‡é£²å“ - æª¸æª¬-é’æª¸å‘³ LiftoffÂ® Effervescent Energy Drink - Lemon-Lime Blast', vp: 15.95, earnBase: 271.00, literature: 0.00, retail: 296.00 },
            '2872': { name: 'LiftoffÂ® èƒ½é‡é£²å“ - é¦™æ©™å‘³ LiftoffÂ® Effervescent Energy Drink - Ignite-Me Orange', vp: 15.95, earnBase: 271.00, literature: 0.00, retail: 296.00 },
            '3115': { name: 'å¤šç¨®ç¶­ä»–å‘½ F2 Multivitamin Complex', vp: 19.95, earnBase: 332.00, literature: 0.00, retail: 363.00 },
            '011K': { name: 'å„ªè³ªè›‹ç™½å’–å•¡ - æœ±å¤åŠ›å’–å•¡ High Protein Iced Coffee - Mocha', vp: 25.95, earnBase: 437.00, literature: 0.00, retail: 478.00 },
            '072K': { name: 'ç‡Ÿé¤Šè›‹ç™½ç´ â”€ç²¾é¸é…æ–¹ Formula 1 Select Nutritional Protein Drink Mix -Natural Vanilla', vp: 21.65, earnBase: 420.00, literature: 0.00, retail: 460.00 },
            '111K': { name: 'Vitamin Mask â€“ Moisturizing ç¶­ä»–å‘½é¢è†œ â€“ ä¿æ¿•', vp: 8.40, earnBase: 144.00, literature: 0.00, retail: 168.00 },
            '145K': { name: 'ç¦¦ä¹‹å¯¶ - é»‘åŠ ä¾–å­å‘³ ImmuLift - Blackcurrant', vp: 10.00, earnBase: 175.00, literature: 0.00, retail: 191.00 },
            '163A': { name: 'ä¸‰å¤©é«”é©—å¥—è£ 3 Days Trail Pack', vp: 7.80, earnBase: 149.00, literature: 0.00, retail: 166.00 },
            '202K': { name: 'é‹…ç¶­æ€ - å¤©ç„¶é¦™æ©™èœœç³–å‘³ Best Defense - Honey Orange', vp: 9.95, earnBase: 172.00, literature: 0.00, retail: 188.00 },
            '291K': { name: 'é†’è…¦éˆ CogniProtect', vp: 30.35, earnBase: 523.00, literature: 0.00, retail: 572.00 },
            '006K': { name: 'ä¸€å£è›‹ç™½æ£’ - é¹½å‘³ç„¦ç³–è„†è„† Protein Bites - Crunchy Salted Caramel', vp: 9.24, earnBase: 141.00, literature: 0.00, retail: 252.00 },
            '1927': { name: 'ç‡Ÿé¤Šè›‹ç™½ç´  - ç´…è±†è–ä» Formula 1 Nutritional Protein Drink Mix - Red Bean', vp: 23.95, earnBase: 418.00, literature: 0.00, retail: 457.00 },
            
            // éç”¢å“/è²»ç”¨é …ç›® (VP/Earn Base = 0)
            '0909': { name: 'æœƒç±æœå‹™å¹´è²» - é ˜ç­ Annual Membership Services Fee - Supervisor', vp: 0.00, earnBase: 0.00, literature: 613.00, retail: 613.00 },
            '5092': { name: 'ä¸­ã€è‹±é›™èªé›¶å”®è¨‚è³¼å–® Retail Order Form Pad', vp: 0.00, earnBase: 0.00, literature: 46.00, retail: 46.00 },
            '9909': { name: 'æœƒç±æœå‹™å¹´è²» - æœƒå“¡ Annual Membership Services Fee - Member', vp: 0.00, earnBase: 0.00, literature: 92.00, retail: 92.00 },
            '9942': { name: 'Bizworks ç™»è¨˜æœˆè²» Bizworks Subscription', vp: 0.00, earnBase: 0.00, literature: 66.00, retail: 66.00 },
            '9943': { name: 'Bizworks é¦–æ¬¡ç™»è¨˜å…2å€‹æœˆæœˆè²»å„ªæƒ  Bizworks 2-month Promotion for first time reg', vp: 0.00, earnBase: 0.00, literature: 0.00, retail: 0.00 },
            'H378': { name: 'Herbalife Business Pack', vp: 0.00, earnBase: 0.00, literature: 422.00, retail: 422.00 },
            'H380': { name: 'Preferred Customer Premium Pack', vp: 0.00, earnBase: 0.00, literature: 175.00, retail: 175.00 },
            'H382': { name: 'Herbalife Business Conversion Pack', vp: 0.00, earnBase: 0.00, literature: 422.00, retail: 422.00 }
        };
        // ==========================================================


        // --- åˆå§‹åŒ– ---
        document.addEventListener('DOMContentLoaded', () => {
            addRow(); // é è¨­æ–°å¢ä¸€è¡Œç©ºç”¢å“
            calculateTotals();
        });

        // --- é‹è²»é–‹é—œæ§åˆ¶ (å·²æ–°å¢) ---
        function toggleShipping() {
            isShippingIncluded = !isShippingIncluded;
            const btn = document.getElementById('toggleShippingBtn');
            if (isShippingIncluded) {
                btn.textContent = 'ä¸åŠ å…¥é‹è²»';
                btn.style.backgroundColor = '#f0ad4e';
                document.getElementById('sum-shipping').style.color = '#333';
            } else {
                btn.textContent = 'åŠ å…¥é‹è²»';
                btn.style.backgroundColor = '#5cb85c';
                document.getElementById('sum-shipping').style.color = '#dc3545';
            }
            calculateTotals();
        }

        // --- æ ¸å¿ƒæŸ¥æ‰¾å‡½æ•¸ (SKU Lookup) ---
        function lookupProduct(inputElement) {
            const sku = inputElement.value.toUpperCase().trim();
            const row = inputElement.closest('tr');
            const product = productDatabase[sku];

            const productName = row.cells[3].querySelector('input');
            const vp = row.cells[4].querySelector('[data-field="vp"]');
            const earnBase = row.cells[5].querySelector('[data-field="earnBase"]');
            const literaturePrice = row.cells[6].querySelector('[data-field="literaturePrice"]');
            const retailPrice = row.cells[7].querySelector('[data-field="retailPrice"]');

            if (product) {
                // æ‰¾åˆ°ç”¢å“ï¼Œè‡ªå‹•å¡«å……è³‡æ–™
                productName.value = product.name;
                vp.value = product.vp;
                earnBase.value = product.earnBase;
                literaturePrice.value = product.literature;
                retailPrice.value = product.retail;
            } else {
                // æœªæ‰¾åˆ°ç”¢å“ï¼Œæ¸…ç©ºæ¬„ä½ (ä¸¦ç¶­æŒ 0)
                productName.value = 'æœªæ‰¾åˆ°';
                vp.value = 0;
                earnBase.value = 0;
                literaturePrice.value = 0;
                retailPrice.value = 0;
            }

            calculateTotals(); 
        }

        // --- ç”¢å“åç¨±æœå°‹åŠŸèƒ½ ---
        function performSearch() {
            const searchTerm = document.getElementById('productNameSearch').value.toUpperCase().trim();
            const resultsDiv = document.getElementById('searchResults');
            resultsDiv.innerHTML = '';
            
            if (searchTerm.length < 2) {
                resultsDiv.innerHTML = '<p style="color: red; margin: 0;">è«‹è¼¸å…¥è‡³å°‘ 2 å€‹é—œéµå­—é€²è¡Œæœå°‹ã€‚</p>';
                resultsDiv.style.display = 'block';
                return;
            }

            let found = false;
            for (const sku in productDatabase) {
                const product = productDatabase[sku];
                // æœå°‹ç”¢å“åç¨±æ˜¯å¦åŒ…å«é—œéµå­—
                if (product.name.toUpperCase().includes(searchTerm)) {
                    found = true;
                    const resultItem = document.createElement('div');
                    resultItem.innerHTML = `
                        <span style="font-weight: bold;">[${sku}]</span> ${product.name} 
                        <span style="color: #007bff;">(é›¶å”®åƒ¹: HK$ ${product.retail.toFixed(2)})</span>
                        <button onclick="addProductFromSearch('${sku}')" style="margin-left: 15px; background: #28a745; color: white; border: none; padding: 4px 8px; cursor: pointer; border-radius: 3px;">åŠ å…¥</button>
                    `;
                    resultItem.style.padding = '5px 0';
                    resultItem.style.borderBottom = '1px dotted #eee';
                    resultsDiv.appendChild(resultItem);
                }
            }

            if (!found) {
                resultsDiv.innerHTML = '<p style="color: #6c757d; margin: 0;">æœªæ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„ç”¢å“ã€‚è«‹å˜—è©¦ä¸åŒçš„é—œéµå­—ã€‚</p>';
            }

            resultsDiv.style.display = 'block';
        }

        // --- å¾æœå°‹çµæœåŠ å…¥ç”¢å“ ---
        function addProductFromSearch(sku) {
            addRow(sku, 1);
            // æ¸…ç©ºæœå°‹æ¬„ä½å’Œçµæœ
            document.getElementById('searchResults').style.display = 'none';
            document.getElementById('productNameSearch').value = ''; 
        }

        // --- æ·»åŠ è¡Œ ---
        function addRow(sku = '', qty = 1) {
            const tableBody = document.querySelector('#productTable tbody');
            const newRow = tableBody.insertRow();

            newRow.innerHTML = `
                <td><button class="remove-btn" onclick="removeRow(this)">ç§»é™¤</button></td>
                <td><input type="text" class="sku-input" onchange="lookupProduct(this)" placeholder="è¼¸å…¥SKU" value="${sku}" ></td>
                <td><input type="number" class="qty-input" min="1" value="${qty}" oninput="calculateTotals()"></td>
                <td><input type="text" class="read-only" readonly value="---"></td>
                <td><input type="number" class="read-only" readonly value="0" data-field="vp"></td>
                <td><input type="number" class="read-only" readonly value="0" data-field="earnBase"></td>
                <td><input type="number" class="read-only" readonly value="0" data-field="literaturePrice"></td>
                <td><input type="number" class="read-only" readonly value="0" data-field="retailPrice"></td>
            `;
            
            if (sku) {
                const skuInput = newRow.cells[1].querySelector('.sku-input');
                lookupProduct(skuInput);
            } else {
                calculateTotals();
            }
        }

        // --- å¿«é€Ÿè¼¸å…¥åŠŸèƒ½ ---
        function quickFill() {
            const tableBody = document.querySelector('#productTable tbody');
            tableBody.innerHTML = '';
            
            QUICK_FILL_SKUS.forEach(sku => {
                addRow(sku.toUpperCase(), 1); 
            });

            calculateTotals();
        }

        function removeRow(buttonElement) {
            const row = buttonElement.closest('tr');
            row.remove();
            calculateTotals();
        }


        // --- æ ¸å¿ƒç¸½è¨ˆç®—å‡½æ•¸ (å·²æ›´æ–°é‚è¼¯) ---
        function calculateTotals() {
            const rows = document.querySelectorAll('#productTable tbody tr');
            let totalVP = 0;
            let totalEarnBase = 0;
            let overallTotalRetail = 0; // æ‰€æœ‰ç”¢å“çš„é›¶å”®ç¸½åƒ¹
            
            const discountLevelElement = document.getElementById('discountLevel');
            const discountFactor = parseFloat(discountLevelElement.value); 
            const discountPercentage = (discountFactor * 100).toFixed(0) + '%'; 

            rows.forEach(row => {
                const qty = parseInt(row.cells[2].querySelector('.qty-input').value) || 0;
                const vp = parseFloat(row.cells[4].querySelector('[data-field="vp"]').value) || 0;
                const earnBase = parseFloat(row.cells[5].querySelector('[data-field="earnBase"]').value) || 0;
                const retailPrice = parseFloat(row.cells[7].querySelector('[data-field="retailPrice"]').value) || 0;

                // ç´¯åŠ æ‰€æœ‰ç¸½è¨ˆ
                totalVP += vp * qty;
                totalEarnBase += earnBase * qty;
                overallTotalRetail += retailPrice * qty;
            });
            
            // æ ¹æ“šæ–°å…¬å¼è¨ˆç®—ç¸½æŠ˜æ‰£é‡‘é¡: ç¸½æ”¶å…¥åŸºæ•¸ x æŠ˜æ‰£ç‡
            const totalDiscountAmount = totalEarnBase * discountFactor;

            // æœ€çµ‚å®¢æˆ¶æ‡‰ä»˜ç”¢å“ç¸½åƒ¹ (æœƒå“¡åƒ¹): ç¸½é›¶å”®åƒ¹ - ç¸½æŠ˜æ‰£é‡‘é¡
            const finalProductTotal = overallTotalRetail - totalDiscountAmount;

            // é‹è²»è™•ç†
            const appliedShippingFee = isShippingIncluded ? SHIPPING_FEE : 0.00;
            const shippingDisplay = isShippingIncluded ? `HK$ ${SHIPPING_FEE.toFixed(2)}` : `HK$ 0.00 (ä¸åŠ å…¥)`;
            
            // æ‡‰æ”¶ç¸½é‡‘é¡ (ç”¢å“ç¸½åƒ¹ + é‹è²»)
            const totalAmountDue = finalProductTotal + appliedShippingFee;

            // --- æ›´æ–°ç¸½çµå€å¡Š ---
            document.getElementById('sum-vp').textContent = totalVP.toFixed(2);
            document.getElementById('sum-earnBase').textContent = totalEarnBase.toFixed(2);
            document.getElementById('sum-totalRetail').textContent = `HK$ ${overallTotalRetail.toFixed(2)}`;
            document.getElementById('sum-discountAmount').textContent = `- HK$ ${totalDiscountAmount.toFixed(2)}`;
            document.getElementById('discount-display').textContent = discountPercentage;
            document.getElementById('sum-shipping').textContent = shippingDisplay;
            document.getElementById('sum-totalDue').textContent = `HK$ ${totalAmountDue.toFixed(2)}`;
        }
    </script>

</body>
</html>
